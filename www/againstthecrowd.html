<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no
		initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Rock This Way</title>

    <link href="ui/css/style.css" rel="stylesheet">

    <script src="cordova.js"></script>
    <script src="bundle.js"></script>
    <script src="crowdanswers.js"></script>

    <script type="text/javascript">
        //        //Score Keeping
        //        if (localStorage.getItem("score") != undefined) {
        //            var points = parseInt(localStorage.score);
        //        } else {
        //            var points = 0;
        //        }
        //        var questionNumber = 0;
        //        window.onload = fillQuestions;
        //
        //        var strikes = 0;
        //
        //
        //        //checks answer submition and assesses appropriate points or strikes
        //        function submit() {
        //            if ($('#answer').val() == '') {
        //                $('.hidden').css('opacity', '1.0');
        //            } else {
        //                var matched = false;
        //                var answer = $('#answer').val().toLowerCase();
        //                var answerkey = eval('q' + questionNumber + 'Answers');
        //                for (var i = 0; i < answerkey.length; i++) {
        //                    var obj = answerkey[i];
        //                    for (var j = 0; j < obj.keywords.length; j++) {
        //                        if (obj.keywords[j] == answer) {
        //                            document.getElementById('pointsAwarded').innerHTML = "You got " + obj.points + " points!";
        //                            matched = true;
        //                            points += parseInt(obj.points);
        //                            document.getElementById('crowdPoints').innerHTML = points;
        //                            questionNumber++;
        //                            loadQuestion();
        //                        }
        //                    }
        //                }
        //                if (matched == false) {
        //                    strikes++;
        //                    document.getElementById('strikes').innerHTML += "<div class='animated bounceIn strike'>X</div>";
        //                    if (strikes == 3) {
        //                        document.getElementById('pointsAwarded').innerHTML = "You got 0 points!";
        //                        document.getElementById('strikes').innerHTML = "";
        //                        strikes = 0;
        //                        questionNumber++;
        //                        loadQuestion();
        //                    }
        //                }
        //
        //            }
        //            document.getElementById('answer').value = "";
        //        }
        //
        //        // Creates place holder boxes for number of questions
        //        function fillQuestions() {
        //            var questionList = "";
        //            for (var i = 0; i < questions.length; i++) {
        //                questionList += "<div class='crowdQuestion' id='crowdQ" + i + "'>" + (i + 1) + "</div>";
        //            }
        //            document.getElementById('questionAnswers').innerHTML = questionList;
        //
        //            document.getElementById('crowdPoints').innerHTML = points;
        //
        //            loadQuestion();
        //        }
        //
        //        //Loads the next question
        //        function loadQuestion() {
        //            var prevQNum = "crowdQ" + (questionNumber - 1);
        //            if ((questionNumber - 1) >= 0) {
        //                document.getElementById(prevQNum).style.color = "#888888"
        //            }
        //            var qNum = "crowdQ" + questionNumber;
        //            document.getElementById(qNum).className += " animated";
        //            document.getElementById(qNum).className += " bounceIn";
        //            document.getElementById(qNum).innerHTML = questions[questionNumber];
        //        }
        //
        //        window.onbeforeunload = function (e) {
        //            localStorage.score = points;
        //        };

        window.onload = startQuestion;

        //Score Keeping
        if (localStorage.getItem("score") != undefined) {
            var points = parseInt(localStorage.score);
        } else {
            var points = 0;
        }

        var questionNumber = 0;
        var questionID = eval("q" + questionNumber + "Answers");
        var strikes = 0;
        var numberCorrect = 0;

        //document.getElementById('answer').addEventListener("click", clearAnswer);

        function startQuestion() {
            document.getElementById('strikes').innerHTML = "";
            document.getElementById('submit').innerHTML = "Submit";
            document.getElementById("submit").setAttribute('onclick', 'submit()');
            document.getElementById('question').innerHTML = questions[questionNumber];
            questionID = eval("q" + questionNumber + "Answers");
            var questionList = "";

            for (var i = 0; i < questionID.length; i++) {
                questionList += "<div class='crowdQuestion' id='crowdQ" + i + "'>" + (i + 1) + "</div>";
            }
            document.getElementById('questionAnswers').innerHTML = questionList;
        }

        function submit() {

            var correct = false;
            var answer = $('#answer').val().toLowerCase();
            for (var i = 0; i < questionID.length; i++) {
                if (answer.toLowerCase() == questionID[i].answer.toLowerCase()) {
                    var correctResponse = "crowdQ" + i;

                    document.getElementById(correctResponse).innerHTML = "<div class='answerText'>" + questionID[i].answer + "</div> &nbsp <div class='answerPoints'>" + questionID[i].points + "</div>";

                    document.getElementById(correctResponse).classList.add('animated');
                    document.getElementById(correctResponse).classList.add('flipInY');
                    document.getElementById(correctResponse).classList.remove('crowdQuestion');
                    document.getElementById(correctResponse).classList.add('correctAnswer');
                    numberCorrect++;
                    correct = true;
                }
            }

            if (correct == false) {
                strikes++;
                document.getElementById('answer').style.border = "3px solid #ff0000";
            }

            if (strikes == 3) {
                for (var i = 0; i < questionID.length; i++) {
                    var correctResponse = "crowdQ" + i;

                    document.getElementById(correctResponse).innerHTML = "<div class='answerText'>" + questionID[i].answer + "</div> &nbsp <div class='answerPoints'>" + questionID[i].points + "</div>";
                    document.getElementById(correctResponse).classList = "correctAnswer animated flipInY";


                }

                document.getElementById('strikes').innerHTML = "You got 3 strikes! <br> Points awarded: ";
                prepareMoveOn();

            }

            if (numberCorrect == questionID.length) {
                document.getElementById('strikes').innerHTML = "You got them all! <br> Points awarded: " + points;
                prepareMoveOn();
            }

        }

        function prepareMoveOn() {
            strikes = 0;
            questionNumber++;
            console.log(questionNumber);
            document.getElementById('submit').innerHTML = "Next";
            clearAnswer();
            document.getElementById("submit").setAttribute('onclick', 'startQuestion()');


        }

        function clearAnswer() {
            document.getElementById('answer').value = "";
            document.getElementById('answer').style.border = "3px solid #acacac";
        }
    </script>

</head>




<body id="atcGame">

    <div class="gameHeader">
        <img src="images/arrow.png" class="backButton" onclick="history.back()">


    </div>
    <center>
        <div id="question"></div>
        <input id="answer" type="text" placeholder="Response" onclick="clearAnswer()">


        <div>
            <div id="questionAnswers"></div>
            <br>
            <div id="pointsAwarded"></div>
            <br>
            <center id="strikes"></center>

            <br>
            <button id="submit" class="submitButton" onclick="submit()">Submit</button>
        </div>
    </center>
</body>

</html>